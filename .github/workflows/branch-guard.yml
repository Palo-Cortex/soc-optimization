name: Branch name guard
on:
  pull_request:
    types: [opened, synchronize, reopened, edited]

jobs:
  validate-branch:
    runs-on: ubuntu-latest
    steps:
      - name: Validate SOC Framework branch naming
        run: |
          BRANCH="${{ github.head_ref }}"

          TYPE='(feat|fix|chore|docs|refactor)'

          # Added "project" here
          MODULE='(entrypoint|upon-trigger|hydration|normalization|enrichment|containment|eradication|recovery|communication|data-modeling|correlation|playbooks|lists|common-utils|dashboards|project)'

          COMPONENT='[a-z0-9\-]+'
          SLUG='[a-z0-9\-]+'

          REGEX="^${TYPE}\/${MODULE}\/${COMPONENT}\/${SLUG}$"

          if [[ ! "$BRANCH" =~ $REGEX ]]; then
            echo "❌ Invalid branch name: $BRANCH"
            echo "Expected: <type>/<module>/<component>/<slug>"
            echo "Allowed modules include 'project' for workflow/infra updates."
            exit 1
          fi

          echo "✅ Branch name valid: $BRANCH"
